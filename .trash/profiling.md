How to optimise the code